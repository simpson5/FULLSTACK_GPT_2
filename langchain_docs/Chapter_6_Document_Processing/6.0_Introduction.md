# ğŸ“– Chapter 6: Document Processing - RAG ì‹œìŠ¤í…œì˜ í•µì‹¬

## ğŸ¯ ì´ ì¥ì—ì„œ ë°°ìš¸ ë‚´ìš©
- âœ… RAG (Retrieval Augmented Generation) ê°œë…ê³¼ ë™ì‘ ì›ë¦¬ ì´í•´
- âœ… ë¬¸ì„œ ë¡œë”©, ë¶„í• , ì„ë² ë”©, ì €ì¥ì˜ ì „ì²´ íŒŒì´í”„ë¼ì¸ êµ¬ì¶•
- âœ… Vector Storeì™€ ê²€ìƒ‰ ì‹œìŠ¤í…œ êµ¬í˜„
- âœ… ì‹¤ì œ Document GPT ì• í”Œë¦¬ì¼€ì´ì…˜ ì œì‘

## ğŸ§  RAG (Retrieval Augmented Generation)ë€?

### ê¸°ë³¸ ê°œë…
RAGëŠ” **ê²€ìƒ‰ ì¦ê°• ìƒì„±**ìœ¼ë¡œ, LLMì˜ í•œê³„ë¥¼ ê·¹ë³µí•˜ëŠ” í•µì‹¬ ê¸°ë²•ì…ë‹ˆë‹¤.

```mermaid
graph TD
    A[ì‚¬ìš©ì ì§ˆë¬¸: "fooê°€ ë­ì•¼?"] --> B[ë²¡í„° ê²€ìƒ‰]
    B --> C[ê´€ë ¨ ë¬¸ì„œ ê²€ìƒ‰]
    C --> D[ê²€ìƒ‰ëœ ë¬¸ì„œ + ì§ˆë¬¸]
    D --> E[LLMì—ê²Œ ì „ë‹¬]
    E --> F[ì»¨í…ìŠ¤íŠ¸ ê¸°ë°˜ ë‹µë³€ ìƒì„±]
    
    style A fill:#E6F3FF
    style F fill:#E6FFE6
    style E fill:#FFE6CC
```

### RAGê°€ í•„ìš”í•œ ì´ìœ 

| ë¬¸ì œ | ì¼ë°˜ LLM | RAG ì‹œìŠ¤í…œ |
|------|----------|------------|
| **í›ˆë ¨ ë°ì´í„° í•œê³„** | í›ˆë ¨ ì‹œì ê¹Œì§€ë§Œ ì•Œê³  ìˆìŒ | ìµœì‹  ë¬¸ì„œ ì‹¤ì‹œê°„ ì¶”ê°€ ê°€ëŠ¥ |
| **ì‚¬ì  ë°ì´í„°** | íšŒì‚¬ ë‚´ë¶€ ë¬¸ì„œ ëª¨ë¦„ | ë‚´ë¶€ ë¬¸ì„œ ê²€ìƒ‰í•˜ì—¬ í™œìš© |
| **ì •í™•ì„±** | ì˜ëª»ëœ ì •ë³´ ìƒì„± ê°€ëŠ¥ | ì‹¤ì œ ë¬¸ì„œ ê¸°ë°˜ ë‹µë³€ |
| **íˆ¬ëª…ì„±** | ì •ë³´ ì¶œì²˜ ë¶ˆëª… | ì°¸ì¡° ë¬¸ì„œ ëª…ì‹œ |

### RAG ë™ì‘ ê³¼ì •
```python
# ğŸ§  ê°œë…: RAGì˜ ê¸°ë³¸ íë¦„
# 1. ì§ˆë¬¸ ì…ë ¥
user_question = "Ministry of Peaceê°€ ì–´ë””ì— ìˆë‚˜ìš”?"

# 2. ë²¡í„° ê²€ìƒ‰ìœ¼ë¡œ ê´€ë ¨ ë¬¸ì„œ ì°¾ê¸°
relevant_docs = vector_store.search(user_question, top_k=3)

# 3. ì»¨í…ìŠ¤íŠ¸ + ì§ˆë¬¸ì„ LLMì—ê²Œ ì „ë‹¬
context = "\n".join([doc.content for doc in relevant_docs])
prompt = f"ë¬¸ì„œ: {context}\n\nì§ˆë¬¸: {user_question}\në‹µë³€:"

# 4. LLMì´ ë¬¸ì„œë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë‹µë³€ ìƒì„±
answer = llm.invoke(prompt)
```

## ğŸ”„ Document Processing íŒŒì´í”„ë¼ì¸

### ì „ì²´ íë¦„ë„
```mermaid
graph LR
    A[ì›ë³¸ ë¬¸ì„œ<br/>PDF, TXT, DOCX] --> B[Document Loaders<br/>UnstructuredFileLoader]
    B --> C[Text Splitters<br/>ì²­í¬ë¡œ ë¶„í• ]
    C --> D[Embeddings<br/>ë²¡í„°ë¡œ ë³€í™˜]
    D --> E[Vector Store<br/>Chroma, FAISS]
    E --> F[Retriever<br/>ê²€ìƒ‰ ì¸í„°í˜ì´ìŠ¤]
    F --> G[RetrievalQA<br/>ì§ˆì˜ì‘ë‹µ ì²´ì¸]
    
    style A fill:#FFE6E6
    style D fill:#E6F3FF
    style G fill:#E6FFE6
```

### ê° ë‹¨ê³„ë³„ ì—­í• 

#### 1. ğŸ“¥ Loading (ë¬¸ì„œ ë¡œë”©)
- **ëª©ì **: ë‹¤ì–‘í•œ í˜•ì‹ì˜ ë¬¸ì„œë¥¼ LangChain Document í˜•íƒœë¡œ ë³€í™˜
- **ë„êµ¬**: `UnstructuredFileLoader`, `PyPDFLoader`, `TextLoader`
- **ê²°ê³¼**: ë©”íƒ€ë°ì´í„°ê°€ í¬í•¨ëœ Document ê°ì²´

#### 2. âœ‚ï¸ Splitting (í…ìŠ¤íŠ¸ ë¶„í• )
- **ëª©ì **: ê¸´ ë¬¸ì„œë¥¼ ì˜ë¯¸ ìˆëŠ” ì‘ì€ ì²­í¬ë¡œ ë¶„í• 
- **ì´ìœ **: LLM í† í° ì œí•œ, ê²€ìƒ‰ ì •í™•ë„ í–¥ìƒ, ë¹„ìš© ìµœì í™”
- **ë„êµ¬**: `RecursiveCharacterTextSplitter`, `CharacterTextSplitter`

#### 3. ğŸ”¢ Embedding (ì„ë² ë”©)
- **ëª©ì **: í…ìŠ¤íŠ¸ë¥¼ ìˆ˜ì¹˜ ë²¡í„°ë¡œ ë³€í™˜í•˜ì—¬ ì˜ë¯¸ì  ê²€ìƒ‰ ê°€ëŠ¥í•˜ê²Œ ë§Œë“¦
- **ì›ë¦¬**: ì˜ë¯¸ê°€ ìœ ì‚¬í•œ í…ìŠ¤íŠ¸ëŠ” ë²¡í„° ê³µê°„ì—ì„œ ê°€ê¹Œì´ ìœ„ì¹˜
- **ë„êµ¬**: `OpenAIEmbeddings`, `CacheBackedEmbeddings`

#### 4. ğŸ’¾ Vector Store (ë²¡í„° ì €ì¥)
- **ëª©ì **: ì„ë² ë”© ë²¡í„°ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ì €ì¥í•˜ê³  ê²€ìƒ‰
- **ê¸°ëŠ¥**: ìœ ì‚¬ë„ ê²€ìƒ‰, í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰, ë©”íƒ€ë°ì´í„° í•„í„°ë§
- **ë„êµ¬**: `Chroma`, `FAISS`, `Pinecone`

## ğŸ¯ RAGì˜ ë‹¤ì–‘í•œ ì „ëµ

### 1. Stuff Strategy
```python
# ğŸ§  ê°œë…: ëª¨ë“  ê´€ë ¨ ë¬¸ì„œë¥¼ í•œ ë²ˆì— LLMì—ê²Œ ì „ë‹¬
relevant_docs = retriever.get_relevant_documents(query)
all_docs = "\n".join([doc.page_content for doc in relevant_docs])
response = llm.invoke(f"{all_docs}\n\nì§ˆë¬¸: {query}")
```
- **ì¥ì **: ê°„ë‹¨í•œ êµ¬í˜„, ë¹ ë¥¸ ì‘ë‹µ
- **ë‹¨ì **: í† í° ì œí•œì— ê±¸ë¦¬ê¸° ì‰¬ì›€

### 2. Map-Reduce Strategy
```python
# ğŸ§  ê°œë…: ê° ë¬¸ì„œë³„ë¡œ ë‹µë³€ì„ ìƒì„±í•œ í›„ ì¢…í•©
individual_answers = []
for doc in relevant_docs:
    answer = llm.invoke(f"ë¬¸ì„œ: {doc}\nì§ˆë¬¸: {query}")
    individual_answers.append(answer)

final_answer = llm.invoke(f"ê°œë³„ ë‹µë³€ë“¤ì„ ì¢…í•©í•˜ì„¸ìš”: {individual_answers}")
```
- **ì¥ì **: ë§ì€ ë¬¸ì„œ ì²˜ë¦¬ ê°€ëŠ¥
- **ë‹¨ì **: ë¹„ìš© ì¦ê°€, ì²˜ë¦¬ ì‹œê°„ ì¦ê°€

### 3. Refine Strategy
- ì²« ë²ˆì§¸ ë¬¸ì„œë¡œ ì´ˆê¸° ë‹µë³€ ìƒì„±
- ë‹¤ìŒ ë¬¸ì„œë“¤ë¡œ ì ì§„ì ìœ¼ë¡œ ë‹µë³€ ê°œì„ 
- ìˆœì°¨ì  ì²˜ë¦¬ë¡œ ë§¥ë½ ìœ ì§€

## ğŸ’¡ ì‹¤ë¬´ ê³ ë ¤ì‚¬í•­

### ë¹„ìš© ìµœì í™”
- **ì„ë² ë”© ìºì‹±**: `CacheBackedEmbeddings`ë¡œ ì¤‘ë³µ ê³„ì‚° ë°©ì§€
- **ì²­í¬ í¬ê¸° ì¡°ì ˆ**: ë„ˆë¬´ ì‘ìœ¼ë©´ ì˜ë¯¸ ì†ì‹¤, ë„ˆë¬´ í¬ë©´ ë¹„ìš© ì¦ê°€
- **ê²€ìƒ‰ ê°œìˆ˜ ì œí•œ**: `top_k` ë§¤ê°œë³€ìˆ˜ë¡œ ê´€ë ¨ ë¬¸ì„œ ìˆ˜ ì¡°ì ˆ

### ì„±ëŠ¥ ìµœì í™”
- **ë²¡í„° ì €ì¥ì†Œ ì„ íƒ**: ë©”ëª¨ë¦¬(Chroma) vs ë””ìŠ¤í¬(FAISS) vs í´ë¼ìš°ë“œ(Pinecone)
- **ì„ë² ë”© ëª¨ë¸**: ì •í™•ë„ vs ì†ë„ vs ë¹„ìš© ê· í˜•
- **ì²­í¬ ê²¹ì¹¨**: `chunk_overlap`ìœ¼ë¡œ ì˜ë¯¸ ì—°ê²°ì„± ìœ ì§€

### í’ˆì§ˆ í–¥ìƒ
- **ë©”íƒ€ë°ì´í„° í™œìš©**: ë‚ ì§œ, ì €ì, ì¹´í…Œê³ ë¦¬ë¡œ ê²€ìƒ‰ í•„í„°ë§
- **í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰**: ë²¡í„° ê²€ìƒ‰ + í‚¤ì›Œë“œ ê²€ìƒ‰ ì¡°í•©
- **ë¦¬ë­í‚¹**: ê²€ìƒ‰ ê²°ê³¼ë¥¼ ë‹¤ì‹œ ì •ë ¬í•˜ì—¬ ê´€ë ¨ì„± í–¥ìƒ

## ğŸ—ºï¸ Chapter 6 í•™ìŠµ ë¡œë“œë§µ

```mermaid
graph TD
    A[6.0 Introduction<br/>RAG ê°œë…] --> B[6.1 Data Loaders<br/>ë¬¸ì„œ ë¡œë”©]
    B --> C[6.2 Tiktoken<br/>í† í°í™”]
    C --> D[6.3 Vectors<br/>ì„ë² ë”© ì´í•´]
    D --> E[6.4 Vector Store<br/>ë²¡í„° ì €ì¥ì†Œ]
    E --> F[6.6 RetrievalQA<br/>ì§ˆì˜ì‘ë‹µ ì²´ì¸]
    F --> G[6.8 Stuff Chain<br/>LCEL êµ¬í˜„]
    G --> H[6.9 Map Reduce<br/>ê³ ê¸‰ ì „ëµ]
    H --> I[6.10 Recap<br/>ì¢…í•© ì •ë¦¬]
    
    style A fill:#f9f,stroke:#333,stroke-width:4px
    style I fill:#9f9,stroke:#333,stroke-width:4px
```

### í•™ìŠµ ìš°ì„ ìˆœìœ„
1. **í•„ìˆ˜**: 6.1-6.4 (ê¸°ë³¸ íŒŒì´í”„ë¼ì¸)
2. **ì¤‘ìš”**: 6.6, 6.8 (ì§ˆì˜ì‘ë‹µ ì²´ì¸)
3. **ì‹¬í™”**: 6.9 (ê³ ê¸‰ ì „ëµ)

## ğŸ› ï¸ ê°œë°œ í™˜ê²½ ì¤€ë¹„

### í•„ìš”í•œ íŒ¨í‚¤ì§€
```bash
pip install langchain
pip install openai
pip install chromadb
pip install tiktoken
pip install unstructured
```

### ê¸°ë³¸ ì„í¬íŠ¸
```python
from langchain.document_loaders import UnstructuredFileLoader
from langchain.text_splitter import CharacterTextSplitter
from langchain.embeddings import OpenAIEmbeddings
from langchain.vectorstores import Chroma
from langchain.chains import RetrievalQA
from langchain.chat_models import ChatOpenAI
```

## âš ï¸ ì£¼ì˜ì‚¬í•­

### ë¹„ìš© ê´€ë ¨
- ì„ë² ë”© ìƒì„±ì€ ìœ ë£Œ ì„œë¹„ìŠ¤ (OpenAI Embeddings)
- ë¬¸ì„œ í¬ê¸°ì™€ ì²­í¬ ìˆ˜ì— ë¹„ë¡€í•˜ì—¬ ë¹„ìš© ì¦ê°€
- ìºì‹±ì„ í†µí•œ ì¤‘ë³µ ë¹„ìš© ë°©ì§€ í•„ìˆ˜

### ì„±ëŠ¥ ê´€ë ¨
- í° ë¬¸ì„œëŠ” ë¶„í•  í•„ìˆ˜ (í† í° ì œí•œ)
- ë²¡í„° ê²€ìƒ‰ì€ ì •í™•í•˜ì§€ë§Œ í‚¤ì›Œë“œ ê²€ìƒ‰ë„ ë•Œë¡œëŠ” ìœ ìš©
- ì‹¤ì‹œê°„ ì²˜ë¦¬ë³´ë‹¤ëŠ” ë°°ì¹˜ ì²˜ë¦¬ê°€ íš¨ìœ¨ì 

### ë³´ì•ˆ ê´€ë ¨
- ë¯¼ê°í•œ ë¬¸ì„œëŠ” ë¡œì»¬ ë²¡í„° ì €ì¥ì†Œ ì‚¬ìš© ê¶Œì¥
- API í‚¤ ë³´ì•ˆ ê´€ë¦¬
- ë¬¸ì„œ ì ‘ê·¼ ê¶Œí•œ ê´€ë¦¬

## ğŸ”— ë‹¤ìŒ ë‹¨ê³„
- **ë‹¤ìŒ í•™ìŠµ**: [6.1 Data Loaders and Splitters](./6.1_Data_Loaders_and_Splitters.md)
- **ê´€ë ¨ ì£¼ì œ**: [Chapter 5: Memory](../Chapter_5_Memory/5.0_Introduction.md)
- **ì‹¤ìŠµ í”„ë¡œì íŠ¸**: Document GPT êµ¬ì¶•

---

ğŸ’¡ **í•µì‹¬ ìš”ì•½**: RAGëŠ” LLMì˜ í•œê³„ë¥¼ ê·¹ë³µí•˜ëŠ” í•µì‹¬ ê¸°ë²•ìœ¼ë¡œ, ì™¸ë¶€ ë¬¸ì„œë¥¼ ê²€ìƒ‰í•˜ì—¬ LLMì—ê²Œ ì œê³µí•¨ìœ¼ë¡œì¨ ë” ì •í™•í•˜ê³  ìµœì‹ ì˜ ì •ë³´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•œ ë‹µë³€ì„ ìƒì„±í•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤. Document Processing íŒŒì´í”„ë¼ì¸ì„ í†µí•´ ì‹¤ì œ Document GPTë¥¼ êµ¬ì¶•í•´ë³´ê² ìŠµë‹ˆë‹¤.